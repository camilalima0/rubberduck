{
    "name": "Python 3 & Web App (Ubuntu Base)",
    "image": "mcr.microsoft.com/devcontainers/python:3",

    "features": {
        "ghcr.io/devcontainers/features/ngrok:1": {
            "version": "latest", 
            "authtoken": "${NGROK_AUTHTOKEN}" 
        },
        "ghcr.io/devcontainers/features/stripe-cli:1": {
            "version": "latest" 
        }
    },
    
     "postCreateCommand": {

        "install_stripe_cli": "sudo apt update && sudo apt install -y curl gnupg && curl -s https://packages.stripe.dev/api/security/keypair/stripe-cli-gpg/public | gpg --dearmor | sudo tee /usr/share/keyrings/stripe.gpg && echo \"deb [signed-by=/usr/share/keyrings/stripe.gpg] https://packages.stripe.dev/stripe-cli-debian-local stable main\" | sudo tee -a /etc/apt/sources.list.d/stripe.list && sudo apt update && sudo apt install -y stripe",
        
        "install_sqlite3_cli": "sudo apt install -y sqlite3",

        "setup_python_venv": "python3 -m venv .venv",
        "install_python_deps": "/bin/bash -c 'source .venv/bin/activate && pip install -r requirements.txt'"

    },

    "remoteEnv": {
        "NGROK_AUTHTOKEN": "${localEnv:NGROK_AUTHTOKEN}" 
    },

    "postStartCommand": "ngrok http 5000 --log=stdout > ngrok.log &",

    "forwardPorts": [5000],

    "customizations": {
        "vscode": {
            "extensions": [
                "ms-python.python",
                "ms-python.vscode-pylance"
            ]
        }
    }
}
    
